# Day 08 ç¤ºä¾‹ä»£ç è®²è§£

## ğŸ¯ ä»£ç ç»“æ„

Day 08 å®ç°äº†å¤šé‡çº¹ç†æ··åˆåŠŸèƒ½ï¼Œä¸»è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

```
day08/
â”œâ”€â”€ Day08Activity.kt      # UI æ§åˆ¶å’Œäº‹ä»¶å¤„ç†
â”œâ”€â”€ Day08Renderer.kt      # OpenGL æ¸²æŸ“é€»è¾‘
â””â”€â”€ activity_day08.xml    # å¸ƒå±€æ–‡ä»¶
```

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

### 1. å¤šçº¹ç†å•å…ƒä½¿ç”¨

```kotlin
// æ¿€æ´»çº¹ç†å•å…ƒ 0 å¹¶ç»‘å®šåº•å›¾
GLES20.glActiveTexture(GLES20.GL_TEXTURE0)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture1)
GLES20.glUniform1i(uTexture1Location, 0)  // ä¼ é€’ç´¢å¼• 0

// æ¿€æ´»çº¹ç†å•å…ƒ 1 å¹¶ç»‘å®šå åŠ å›¾
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, texture2)
GLES20.glUniform1i(uTexture2Location, 1)  // ä¼ é€’ç´¢å¼• 1
```

**å…³é”®ç‚¹**ï¼š
- `glActiveTexture()` æ¿€æ´»çº¹ç†å•å…ƒï¼ˆGL_TEXTURE0, GL_TEXTURE1, ...ï¼‰
- `glUniform1i()` ä¼ é€’çš„æ˜¯ç´¢å¼•ï¼ˆ0, 1, ...ï¼‰ï¼Œä¸æ˜¯ GL_TEXTURE å¸¸é‡
- å¯ä»¥åŒæ—¶ä½¿ç”¨å¤šä¸ªçº¹ç†å•å…ƒï¼ˆé€šå¸¸æ”¯æŒ 8-32 ä¸ªï¼‰

### 2. æ··åˆæ¨¡å¼ç€è‰²å™¨

```glsl
// ç‰‡æ®µç€è‰²å™¨ä¸­çš„æ··åˆé€»è¾‘
uniform sampler2D uTexture1;  // åº•å›¾
uniform sampler2D uTexture2;  // å åŠ å›¾
uniform int uBlendMode;       // æ··åˆæ¨¡å¼
uniform float uAlpha;         // é€æ˜åº¦

void main() {
    vec4 base = texture2D(uTexture1, vTexCoord);
    vec4 blend = texture2D(uTexture2, vTexCoord);
    
    if (uBlendMode == 0) {
        // Alpha æ··åˆ
        result = mix(base.rgb, blend.rgb, uAlpha);
    } else if (uBlendMode == 1) {
        // ç›¸åŠ æ··åˆ
        result = min(base.rgb + blend.rgb * uAlpha, vec3(1.0));
    }
    // ... å…¶ä»–æ··åˆæ¨¡å¼
}
```

**æ”¯æŒçš„æ··åˆæ¨¡å¼**ï¼š
- **Alpha æ··åˆ**ï¼šé€æ˜å åŠ ï¼ˆ`mix()`ï¼‰
- **ç›¸åŠ **ï¼šé¢œè‰²ç›¸åŠ ï¼Œå¢äº®æ•ˆæœ
- **ç›¸ä¹˜**ï¼šé¢œè‰²ç›¸ä¹˜ï¼Œå˜æš—æ•ˆæœ
- **å±å¹•**ï¼šæŸ”å…‰å¢äº®ï¼ˆç±»ä¼¼ Photoshop çš„å±å¹•æ¨¡å¼ï¼‰
- **å åŠ **ï¼šä¿ç•™é«˜å…‰å’Œé˜´å½±
- **æŸ”å…‰**ï¼šæŸ”å’Œæ··åˆ

### 3. UI äº¤äº’

```kotlin
// SeekBar æ§åˆ¶é€æ˜åº¦
seekBarAlpha.setOnSeekBarChangeListener(object : SeekBar.OnSeekBarChangeListener {
    override fun onProgressChanged(seekBar: SeekBar?, progress: Int, fromUser: Boolean) {
        val alpha = progress / 100.0f
        glSurfaceView.queueEvent {
            renderer.setAlpha(alpha)
        }
    }
})

// æŒ‰é’®åˆ‡æ¢æ··åˆæ¨¡å¼
btnAlpha.setOnClickListener {
    setBlendMode(Day08Renderer.BlendMode.ALPHA)
}
```

**å…³é”®ç‚¹**ï¼š
- ä½¿ç”¨ `queueEvent {}` åœ¨ OpenGL çº¿ç¨‹ä¸­æ›´æ–°å‚æ•°
- SeekBar èŒƒå›´ 0-100ï¼Œæ˜ å°„åˆ°é€æ˜åº¦ 0.0-1.0

## ğŸ¨ æ··åˆæ¨¡å¼è¯¦è§£

### Alpha æ··åˆï¼ˆé€æ˜å åŠ ï¼‰

```glsl
result = mix(base.rgb, blend.rgb, uAlpha);
```

- **æ•ˆæœ**ï¼šæ ¹æ®é€æ˜åº¦åœ¨ä¸¤å¼ å›¾ç‰‡ä¹‹é—´æ’å€¼
- **åº”ç”¨åœºæ™¯**ï¼šæ°´å°ã€UI å åŠ 
- **å‚æ•°**ï¼š`uAlpha = 0.5` è¡¨ç¤º 50% æ··åˆ

### ç›¸åŠ æ··åˆ

```glsl
result = min(base.rgb + blend.rgb * uAlpha, vec3(1.0));
```

- **æ•ˆæœ**ï¼šé¢œè‰²ç›¸åŠ ï¼Œäº§ç”Ÿå¢äº®æ•ˆæœ
- **åº”ç”¨åœºæ™¯**ï¼šå…‰æ™•ã€ç²’å­æ•ˆæœ
- **ç‰¹ç‚¹**ï¼šä¼šè¶…è¿‡ 1.0ï¼Œéœ€è¦ clamp

### ç›¸ä¹˜æ··åˆ

```glsl
result = base.rgb * blend.rgb;
```

- **æ•ˆæœ**ï¼šé¢œè‰²ç›¸ä¹˜ï¼Œäº§ç”Ÿå˜æš—æ•ˆæœ
- **åº”ç”¨åœºæ™¯**ï¼šé˜´å½±ã€è‰²å½©æ ¡æ­£
- **ç‰¹ç‚¹**ï¼šç»“æœæ€»æ˜¯æ¯”åŸè‰²æš—

### å±å¹•æ··åˆ

```glsl
result = 1.0 - (1.0 - base.rgb) * (1.0 - blend.rgb);
```

- **æ•ˆæœ**ï¼šæŸ”å’Œå¢äº®ï¼Œä¿ç•™ç»†èŠ‚
- **åº”ç”¨åœºæ™¯**ï¼šæŸ”å…‰ã€æ°›å›´æ¸²æŸ“
- **ç‰¹ç‚¹**ï¼šç±»ä¼¼ Photoshop çš„å±å¹•æ¨¡å¼

### å åŠ æ··åˆ

```glsl
// æ ¹æ®åŸºç¡€é¢œè‰²çš„äº®åº¦é€‰æ‹©ç›¸ä¹˜æˆ–å±å¹•
result.r = base.r < 0.5 
    ? (2.0 * base.r * blend.r) 
    : (1.0 - 2.0 * (1.0 - base.r) * (1.0 - blend.r));
```

- **æ•ˆæœ**ï¼šå¢å¼ºå¯¹æ¯”åº¦ï¼Œä¿ç•™é«˜å…‰å’Œé˜´å½±
- **åº”ç”¨åœºæ™¯**ï¼šç…§ç‰‡æ»¤é•œã€å¯¹æ¯”å¢å¼º
- **ç‰¹ç‚¹**ï¼šæš—éƒ¨ç”¨ç›¸ä¹˜ï¼Œäº®éƒ¨ç”¨å±å¹•

### æŸ”å…‰æ··åˆ

```glsl
result.r = blend.r < 0.5 
    ? (2.0 * base.r * blend.r + base.r * base.r * (1.0 - 2.0 * blend.r)) 
    : (sqrt(base.r) * (2.0 * blend.r - 1.0) + 2.0 * base.r * (1.0 - blend.r));
```

- **æ•ˆæœ**ï¼šæŸ”å’Œæ··åˆï¼Œä¿ç•™ç»†èŠ‚
- **åº”ç”¨åœºæ™¯**ï¼šäººåƒç¾åŒ–ã€æŸ”å…‰æ•ˆæœ
- **ç‰¹ç‚¹**ï¼šæ¯”å åŠ æ›´æŸ”å’Œ

## ğŸ” ä»£ç æµç¨‹å›¾

```
1. onSurfaceCreated
   â”œâ”€â”€ åˆ›å»ºé¡¶ç‚¹ç¼“å†²
   â”œâ”€â”€ ç¼–è¯‘ç€è‰²å™¨
   â”œâ”€â”€ è·å– uniform ä½ç½®
   â””â”€â”€ ä½¿ç”¨ Glide åŠ è½½ä¸¤å¼ å›¾ç‰‡

2. å›¾ç‰‡åŠ è½½å®Œæˆå›è°ƒ
   â”œâ”€â”€ ä¿å­˜ Bitmap åˆ° pendingBitmap
   â””â”€â”€ è®¾ç½® needUpdateTexture = true

3. onDrawFrame
   â”œâ”€â”€ æ£€æŸ¥æ˜¯å¦éœ€è¦æ›´æ–°çº¹ç†
   â”‚   â”œâ”€â”€ åˆ é™¤æ—§çº¹ç†ï¼ˆå¦‚æœå­˜åœ¨ï¼‰
   â”‚   â”œâ”€â”€ è°ƒç”¨ TextureHelper.loadTexture()
   â”‚   â””â”€â”€ é‡ç½®æ ‡å¿—ä½
   â”œâ”€â”€ æ¿€æ´»çº¹ç†å•å…ƒ 0ï¼Œç»‘å®šåº•å›¾
   â”œâ”€â”€ æ¿€æ´»çº¹ç†å•å…ƒ 1ï¼Œç»‘å®šå åŠ å›¾
   â”œâ”€â”€ è®¾ç½® uniform å˜é‡ï¼ˆæ··åˆæ¨¡å¼ã€é€æ˜åº¦ï¼‰
   â””â”€â”€ ç»˜åˆ¶å…¨å±å››è¾¹å½¢

4. ç”¨æˆ·äº¤äº’
   â”œâ”€â”€ ç§»åŠ¨ SeekBar â†’ è°ƒç”¨ setAlpha()
   â””â”€â”€ ç‚¹å‡»æŒ‰é’® â†’ è°ƒç”¨ setBlendMode()
```

## ğŸš€ è¿è¡Œæ•ˆæœ

è¿è¡Œåº”ç”¨åï¼Œä½ ä¼šçœ‹åˆ°ï¼š

1. **ä¸ŠåŠéƒ¨åˆ†**ï¼šOpenGL æ¸²æŸ“è§†å›¾ï¼Œæ˜¾ç¤ºæ··åˆåçš„å›¾ç‰‡
2. **ä¸‹åŠéƒ¨åˆ†**ï¼šæ§åˆ¶é¢æ¿
   - å½“å‰æ··åˆæ¨¡å¼æ˜¾ç¤º
   - é€æ˜åº¦ SeekBarï¼ˆ0.0 - 1.0ï¼‰
   - 6 ä¸ªæ··åˆæ¨¡å¼æŒ‰é’®

**æ“ä½œæ­¥éª¤**ï¼š
1. æ‹–åŠ¨ SeekBarï¼Œå®æ—¶è°ƒèŠ‚é€æ˜åº¦
2. ç‚¹å‡»ä¸åŒæŒ‰é’®ï¼Œåˆ‡æ¢æ··åˆæ¨¡å¼
3. è§‚å¯Ÿä¸åŒæ··åˆæ¨¡å¼çš„è§†è§‰æ•ˆæœ

## ğŸ’¡ å­¦ä¹ è¦ç‚¹

### çº¹ç†å•å…ƒ vs çº¹ç†å¯¹è±¡

| æ¦‚å¿µ | è¯´æ˜ | ç±»æ¯” |
|------|------|------|
| **çº¹ç†å¯¹è±¡** | å­˜å‚¨çº¹ç†æ•°æ®çš„ ID | U ç›˜ |
| **çº¹ç†å•å…ƒ** | GPU çš„çº¹ç†æ§½ä½ | USB æ¥å£ |
| **æ¿€æ´»** | `glActiveTexture(GL_TEXTURE0)` | é€‰æ‹© USB æ¥å£ |
| **ç»‘å®š** | `glBindTexture(GL_TEXTURE_2D, id)` | æ’å…¥ U ç›˜ |

### å…³é”® API

```kotlin
// 1. æ¿€æ´»çº¹ç†å•å…ƒ
GLES20.glActiveTexture(GLES20.GL_TEXTURE0 + index)

// 2. ç»‘å®šçº¹ç†å¯¹è±¡
GLES20.glBindTexture(GLES20.GL_TEXTURE_2D, textureId)

// 3. ä¼ é€’çº¹ç†å•å…ƒç´¢å¼•ç»™ç€è‰²å™¨
GLES20.glUniform1i(samplerLocation, index)  // æ³¨æ„ï¼šä¼ é€’ç´¢å¼•ï¼Œä¸æ˜¯ GL_TEXTURE å¸¸é‡
```

### å¸¸è§é”™è¯¯

âŒ **é”™è¯¯å†™æ³•**ï¼š
```kotlin
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
GLES20.glUniform1i(texture2Location, GLES20.GL_TEXTURE1)  // é”™è¯¯ï¼
```

âœ… **æ­£ç¡®å†™æ³•**ï¼š
```kotlin
GLES20.glActiveTexture(GLES20.GL_TEXTURE1)
GLES20.glUniform1i(texture2Location, 1)  // ä¼ é€’ç´¢å¼• 1
```

## ğŸ¯ æ‰©å±•ç»ƒä¹ 

### åŸºç¡€ç»ƒä¹ 

1. **ä¿®æ”¹æ··åˆå…¬å¼**ï¼šå°è¯•ä¿®æ”¹æ··åˆæ¨¡å¼çš„è®¡ç®—å…¬å¼
2. **æ·»åŠ æ–°æ¨¡å¼**ï¼šå®ç°å·®å€¼æ··åˆï¼ˆ`abs(base - blend)`ï¼‰
3. **è°ƒæ•´é»˜è®¤å€¼**ï¼šä¿®æ”¹åˆå§‹é€æ˜åº¦å’Œæ··åˆæ¨¡å¼

### è¿›é˜¶ç»ƒä¹ 

1. **ä¸‰çº¹ç†æ··åˆ**ï¼šæ·»åŠ ç¬¬ä¸‰ä¸ªçº¹ç†ï¼ˆæ°´å°ï¼‰
2. **åŠ¨æ€æ··åˆ**ï¼šè®©é€æ˜åº¦éšæ—¶é—´è‡ªåŠ¨å˜åŒ–
3. **åˆ†åŒºåŸŸæ··åˆ**ï¼šä¸åŒåŒºåŸŸä½¿ç”¨ä¸åŒæ··åˆæ¨¡å¼

### æŒ‘æˆ˜ç»ƒä¹ 

1. **å®ç°æ°´å°åŠŸèƒ½**ï¼šåœ¨ç‰¹å®šä½ç½®å åŠ å°å›¾æ ‡
2. **ä¿å­˜å›¾ç‰‡**ï¼šå°†æ··åˆåçš„ç»“æœä¿å­˜åˆ°ç›¸å†Œ
3. **æ€§èƒ½ä¼˜åŒ–**ï¼šç›‘æ§ FPSï¼Œä¼˜åŒ–æ¸²æŸ“æ€§èƒ½

## ğŸ“š å‚è€ƒèµ„æ–™

- [Photoshop æ··åˆæ¨¡å¼æ•°å­¦å…¬å¼](https://en.wikipedia.org/wiki/Blend_modes)
- [GLSL mix() å‡½æ•°](https://www.khronos.org/registry/OpenGL-Refpages/gl4/html/mix.xhtml)
- æœ¬é¡¹ç›® `docs/day08/README.md` è¯¦ç»†æ•™ç¨‹

---

**ç¥å­¦ä¹ æ„‰å¿«ï¼** ğŸ‰

